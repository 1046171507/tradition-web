<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
	</head>

	<body>
		<img id="scream" gray src="data:img/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAAEVCAMAAAC8FHt7AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACYVBMVEX/AAbWAC4BAP71ABAJAPb/AAYkANxcAKWlAF4AAP/yABMiAN4BAP4IAPdZAKjyABOiAGEhAN/WAC7wABUgAODUADBXAKoHAPjwABWfAGTTADHxABSfAGQeAOKcAGfUADDSADLyABNUAK3TADEHAPidAGbUADDzABIdAOOcAGfWAC70ABFUAK2fAGTZACv1ABBVAKyhAGLbACn2AA9WAKukAF/dACf4AA0dAONaAKenAFznAB3/CAb84AMXFej/0AH55AYKCfX/mwLx3Q4EBPv/VQTbySQAAP//IQX/6QCvoVD/CQb/5ACAdX//AQb/6gBPSLD/nAL+6QErJ9T/VgT85wMYFuf/JQX24gkHBvjhzh4BAf7Gtjn/ngKajWX/WQRjW5z/JgX/6gBAO7//Cgb/5AD96AIiH9324gkODfH/oALq1xUFBfr/XATUwyv/JwWgk191a4r/0QH/6gBPSLD/oAIpJtb/XgQWFOn/6QDx3Q4KCfX/CwbWxCn/AQa0pUuJfnb/XwT/6gBSS63/KAUzL8wfHODy3g3/oQICAv3/KQWPg3BBPL796AL/XwQPDvAGBvn/DAbMuzP/0gH/YAREPrv/KwXv2xD/ogL/LQWAdX//owIYFuf/LgX/DgbBsT7/AgY8N8P/Dwb/YwNyaY3/0wEWFOn/LwX/pAL/LwX55Ab/pQK2p0n/Dwb+6QH/YwPk0Rv/EAb/1AFnX5j45Af/pwKomlf/5AArJ9TezCH/EQZaU6X/ZgMKCfWbjmT/MgUmI9n/qgL/EQb/ZgOPg3D/AAb/1gH/AAYAAP//6gD///8P3RpBAAAAx3RSTlO34PD02/7Hv8v99Mjy3L/zysff8sjfv93xyt7xycnJ3t3xwN3fyN3xysfc8b/H2/G+xtvwvcTb8Mm7w9nw2N7L4Ou+1PXFxf7b8r3x3739/cm+8tjF5uXb2fXJ/MK/wMbJ2/XT8eDt4tvxv875xsTbv8TK+c7A4Mbs9NX18cX8v8HH+87a2ubWv/zbwdTpxvH58cLMx9Pb0sDaw7/r2vDA/Nbwx8XL7dvA2uK/wO/0xsrvzMffwL/i38fuy8b0v9niwO3FwPzNdAgOkwAAAAFiS0dEyvO0NuYAAAAHdElNRQfhChgKDjh1xxWQAAAHJklEQVR42u3cZXddRRSH8ZPSS2hpQ6G4F3d3a9ASpIFAkBKgBCiBAG0J0gBtgru7B3cp7i5nvhWN7LlJ7rnnjOyZ2Xuv/j/B/b15zlp7spL9J3hZ6h+wHrce12gTjGuZIRe3wcxcLK62YS4X15rLxW00Sy6uZUYuFjd7Zi4WNxoTsbjWXC5uLCZCceMxkYmbiIlIHMREJK41l4vTMRGIq8dEHm5STMThahvncnGtuVzclJgIw7XMycXipsVEFG56TEThWnO5uIaYCMI1xkQObvbcXCyuKCZicG25XFxhTITgimMiA7fJ3FwsrllMRODacrm4ebPk4prHhD+uJCbscbVNc7m4tlwurjQmzHGbzcnF4ipiwhpXFRPWuKqYcMZVxoQxrjomfHEGMWGLM4kJW5xJTLjijGLCFGcWE564+WYxYYkzjQlLnGlMOOKMY8IQZx4TfjiLmLDD1Ta3svHC2cSEG84qJsxwW1jFhBfOMiascLYxYYXb0t7GBmcdE0Y4+5jwwc3fysXGA+cSEzY4l5hwwc1ztHHAucWEB25rt5iwwLnGhAXONSYccM4xYYBzjwl9nEdMyON8YkIe5xMT6rhtPG2UcX4xoY3zjAlpnG9MSON8Y0IZ5x0TwrhtvWNCF4cQE7I4jJiQxWHEhCoOJSZEcTgxoYnbDicmJHFYMSGJw4oJRdz2iDZqOLyY0MMhxoQcrrYDqo0WDjMm1HA7Itso4XZCjQktHHJMSOGwY0IKhx0TSjj0mBDC7YweEzq4BfgxIYMLERMyuF3C2EjggsSECG7XIDGhgVuwWyhbelyomJDAhYoJBdzuAW2pcXsEi0l63J7hYpIcV9srqC0tLmRMUuP2DmxLidsnaEzS4vYNG5OkuNAxSYrbL7wtGW7/CLZUuAOCxyQd7sDwMUmGixGTZLiD4tiS4A6OZEuBOyRKTNLgDo0TkyS4WDFJgjssni067vCItti4I6LFJD7uyHgxiY6rHRXVFhd3dFxbVNwxkW0xccdGjUlc3HHHnyAWV1uo2k+UijtJKXXyKTJxp6rRnbZIIu70jjGcOkMg7syz1MTOFodbvBBsqvMcabhzVX1d58nCna8mr/sCSbgLO6bg1EUXy8HVYwJbcokU3KSY6PVIwV2qCnaZDNzlRTbVuVQC7oqOQpzqvZI/7qqrVZMtu4Y7rigmsL5rmeOuUyXrv5417gZVuhs545Z3lOPUCr645jHRW8kVt/imSpsauJkp7pZq27oPwq0scbeZ2JRqX8UQt3zQDKduv4Md7s7qmMBWBzyIBcGtMYiJ3hAznFFM9IZZ4e6ysqm772GEu9c0JrCu+9jgLGIC676fCc4qJrAHwnwQ0HEPOtiUWvIQB5xlTPSCHMSQcQ/bxkTvEfI4h5jAQhzEUHFOMYH1Pkob5xYT2GPoHwRM3ONeNqX6nqCLc48JrP9Jqrin3GOi9zRR3Jpn/G3YBzE0nF9M9FAPYli4Z3FsauA5erjnB5FwqAcxHBxGTGCIBzEUHE5MYC+gfRBQcC9i2hAPYhg4rJjoYR3EEHAvDWLj1MtUcJgxgQ3gHMS8cbgxgeEcxLxxr4SwKdX9KgEcekxgGC8knrjXBkPhMA5ifrjXA8RE7420uJEgMdHzfiHxwgWKCcz7IOaDCxYTWO+byXABYwLzfCFxx70VMiYwv4OYMy5wTGD9Ph8EZ1zgmOj5vJC44t6OZPM6iDniIsRE753IuCgxgbm/kDjhRt6NaPM4iDnhYsUE1v5ePFy8mMAcX0gccO/3Rsc5HsTscVFjoud0ELPGRY6JnssLiTXugzQ2p4OYLS5+TGAOBzFL3IcJYgL7aFVYXJqYwKwPYla4VDGB2R7ErHAfp7Up9Uk4XLqY6NkdxCxwKWMCszuImeM+TRoT2Gc2HwRjXOqYwGwOYsa45DGBWRzETHGfpzbV94XxB8EQRyEmesYHMTPcWhIx0TM9iBnhRr5MzZm2rxBxZGICMzyImeAIxQRmdhAzwJGKCexrkw9CNY5YTGAmB7FKHLmYwAwOYpW4b1Ijmu5bbxzBmOhVHsQqcCRjAqs8iJXj1n6XGlC6ru89cGRjAqv4k+FSHN2YwMoPYmU4yjGB/bDIDUc6JnpDTrgfacdEb9gBRz4msM6f7HH0YwJr/kLSDPdz6p9ssaYHsSY4HjGB9f1ig+MSE1iTF5JCHJuY6PWY4/jERO9XUxynmMAKX0gKcL+xigms6CDWiOMWE9iy36tx/GICa3whacD9kfo3uq/hIDYdxzEmeqvLcTxjoreiDMc1Jnorm+P4xgQ29SCWCYkJbMoLSSYlJrDJB7FMTExgkw5imZyYwOovJJmcmOgNNeAExERveBpORExg8E8lM1ExgU0cxMZxf0qJCWz8IJYJiwls7J9KZtJiAhs9iI3i/kr9Q4KsZwwnLCZ6f6/DiYsJrHNp9s+/qX9EsPX+D2VTnWsrLJqiAAAAAElFTkSuQmCC" style="width: 150px; height: 189px;" />
		<script>
			var img = document.getElementById("scream");
			//灰度效果
			//计算公式 .299 * r + .587 * g + .114 * b;
			var idx, r, g, b, gray;

			grayFn = function(canvasData) {
				for(var x = 0, len = canvasData.height; x < len; x++) {
					for(var y = 0, len = canvasData.height; y < len; y++) {
						// Index of the pixel in the array  
						idx = (x + y * canvasData.width) * 4;
						r = canvasData.data[idx + 0];
						g = canvasData.data[idx + 1];
						b = canvasData.data[idx + 2];
						gray = .299 * r + .587 * g + .114 * b;
						// assign gray scale value  
						canvasData.data[idx + 0] = gray; // Red channel  
						canvasData.data[idx + 1] = gray; // Green channel  
						canvasData.data[idx + 2] = gray; // Blue channel  
						canvasData.data[idx + 3] = 255; // Alpha channel  
					}
				}
				return canvasData;
			};

			img.onload = function() {
				var c = document.createElement("canvas");
				var ctx = c.getContext("2d");
				c.width = this.naturalWidth;
				c.height = this.naturalHeight;
				ctx.drawImage(this, 0, 0);
				var imgData = ctx.getImageData(0, 0, c.width, c.height);
				imgData = grayFn(imgData);
				//跨域图片不能处理
				ctx.putImageData(imgData, 0, 0);
				var type = 'png';
				var imgData = c.toDataURL(type);
				this.src = imgData;
				this.onload = null;
			};
		</script>
	</body>

</html>